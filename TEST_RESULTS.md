# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API - https://animelib-api.vercel.app

**–î–∞—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:** 2025-10-31  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç, –Ω–∞–π–¥–µ–Ω–∞ 1 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞)

---

## ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã

### 1. –ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ
**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/proxy/anime?q={–Ω–∞–∑–≤–∞–Ω–∏–µ}&limit={10-60}`

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "https://animelib-api.vercel.app/api/proxy/anime?q=jujutsu&limit=10"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –∞–Ω–∏–º–µ
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `limit` (—Ç—Ä–µ–±—É–µ—Ç—Å—è 10-60)

**–î–∞–Ω–Ω—ã–µ:**
- ID, –Ω–∞–∑–≤–∞–Ω–∏—è (rus, eng, original)
- –û–±–ª–æ–∂–∫–∏ (thumbnail, default, md)
- –†–µ–π—Ç–∏–Ω–≥–∏, —Å—Ç–∞—Ç—É—Å, —Ç–∏–ø, –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ
- –°—Å—ã–ª–∫–∏ –Ω–∞ Shikimori

---

### 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∞–Ω–∏–º–µ
**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/proxy/anime/{slug_url}`

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "https://animelib-api.vercel.app/api/proxy/anime/16133--jujutsu-kaisen-anime"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–π—Ç–ª–µ
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `slug_url` –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞

---

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —ç–ø–∏–∑–æ–¥–æ–≤
**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/proxy/episodes?anime_id={id}&limit={10+}`

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "https://animelib-api.vercel.app/api/proxy/episodes?anime_id=16133&limit=10"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —ç–ø–∏–∑–æ–¥–æ–≤ –∞–Ω–∏–º–µ
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –Ω–æ–º–µ—Ä–µ, —Å–µ–∑–æ–Ω–µ, —Å—Ç–∞—Ç—É—Å–µ

---

### 4. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º —ç–ø–∏–∑–æ–¥–µ (—Å –ø–ª–µ–µ—Ä–∞–º–∏)
**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/proxy/episodes/{episode_id}`

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "https://animelib-api.vercel.app/api/proxy/episodes/41924"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ–ª–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —ç–ø–∏–∑–æ–¥–µ
- **–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–ª–µ–µ—Ä–æ–≤ Kodik** —Å:
  - –ö–æ–º–∞–Ω–¥–∞–º–∏ –æ–∑–≤—É—á–∫–∏ (AniLibria.TV, Studio Band, AniDUB –∏ —Ç.–¥.)
  - –¢–∏–ø–æ–º –ø–µ—Ä–µ–≤–æ–¥–∞ (–æ–∑–≤—É—á–∫–∞/—Å—É–±—Ç–∏—Ç—Ä—ã)
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤
  - –ü—Ä—è–º—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ Kodik –ø–ª–µ–µ—Ä

**–ü—Ä–∏–º–µ—Ä –ø–ª–µ–µ—Ä–∞:**
```json
{
  "id": 83390,
  "player": "Kodik",
  "translation_type": {"id": 2, "label": "–û–∑–≤—É—á–∫–∞"},
  "team": {
    "name": "AniLibria.TV",
    "slug": "anilibriatv"
  },
  "views": 141,
  "src": "//kodik.info/seria/723247/..."
}
```

---

### 5. –ü—Ä–æ–∫—Å–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/proxy/uploads/{path}`

**–ü—Ä–∏–º–µ—Ä:**
```bash
curl "https://animelib-api.vercel.app/api/proxy/uploads/anime/16133/cover/903cef36-9e3e-43b8-aced-7a668da88956_thumb.jpg"
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
- –£—Å–ø–µ—à–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- –û–±—Ö–æ–¥ CORS –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π Content-Type
- –†–∞–∑–º–µ—Ä —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: 12 KB

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ü—Ä–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è SVG placeholder
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: `Cache-Control: public, max-age=3600`

---

### 6. CORS Headers
**–ü—Ä–æ–≤–µ—Ä–∫–∞:** OPTIONS –∑–∞–ø—Ä–æ—Å

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```
Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: GET, OPTIONS
Access-Control-Allow-Headers: Content-Type, Authorization, Range
Access-Control-Max-Age: 86400
```

---

## ‚ùå –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. ‚ùå Kodik API - Hardcoded localhost (–ò–°–ü–†–ê–í–õ–ï–ù–û)

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `GET /api/kodik/episode?episode_id={id}`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
Error: connect ECONNREFUSED 127.0.0.1:3000
```

**–ü—Ä–∏—á–∏–Ω–∞:**  
–í `pages/api/kodik/[...path].js` –±—ã–ª hardcoded `http://localhost:3000` –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ –ø—Ä–æ–∫—Å–∏, —á—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Vercel (serverless).

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –î–û:
const episodeResponse = await axios.get(`http://localhost:3000/api/proxy/episodes/${episode_id}`);

// –ü–û–°–õ–ï:
const host = req.headers.host || 'localhost:3000';
const protocol = req.headers['x-forwarded-proto'] || 'http';
const baseUrl = `${protocol}://${host}`;
const episodeResponse = await axios.get(`${baseUrl}/api/proxy/episodes/${episode_id}`);
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ –∫–æ–º–º–∏—Ç–µ `d4b09ba`

---

### 2. ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ 404 –æ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ API

**–ü—Ä–æ–±–ª–µ–º–∞:**  
–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É 404, –∫–æ—Ç–æ—Ä—É—é –ø—Ä–æ–∫—Å–∏ –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∫–∞–∫ JSON:

```
{"error":"Internal proxy error","details":"Unexpected token '<', \"<!DOCTYPE \"... is not valid JSON"}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**  
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `Content-Type` –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º JSON –≤ `pages/api/proxy/[...path].js`

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)

---

## üìä –°–≤–æ–¥–∫–∞

| –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ |
|-----------|--------|------------|
| –ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ | ‚úÖ | –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–π—Ç–ª–µ | ‚úÖ | –¢—Ä–µ–±—É–µ—Ç—Å—è slug_url |
| –°–ø–∏—Å–æ–∫ —ç–ø–∏–∑–æ–¥–æ–≤ | ‚úÖ | –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –î–µ—Ç–∞–ª–∏ —ç–ø–∏–∑–æ–¥–∞ | ‚úÖ | –í–∫–ª—é—á–∞–µ—Ç Kodik –ø–ª–µ–µ—Ä—ã |
| –ü—Ä–æ–∫—Å–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | ‚úÖ | –° fallback –Ω–∞ placeholder |
| CORS | ‚úÖ | –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω |
| Kodik –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è | ‚ö†Ô∏è | –¢—Ä–µ–±—É–µ—Ç –¥–µ–ø–ª–æ—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è |
| Rate limiting | ‚úÖ | 100 req/min –Ω–∞ IP |
| –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | 5 –º–∏–Ω—É—Ç –¥–ª—è API, 1 —á–∞—Å –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π |

---

## üöÄ –î–µ–π—Å—Ç–≤–∏—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

1. **–ó–∞–ø—É—à–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ GitHub:**
   ```bash
   git push origin main
   ```

2. **–î–æ–∂–¥–∞—Ç—å—Å—è –∞–≤—Ç–æ–¥–µ–ø–ª–æ—è Vercel** (–æ–±—ã—á–Ω–æ 1-2 –º–∏–Ω—É—Ç—ã)

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Kodik API –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:**
   ```bash
   curl "https://animelib-api.vercel.app/api/kodik/episode?episode_id=41924"
   ```

---

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª–Ω—ã–π workflow –ø–æ–ª—É—á–µ–Ω–∏—è –≤–∏–¥–µ–æ:

```bash
# 1. –ü–æ–∏—Å–∫ –∞–Ω–∏–º–µ
curl "https://animelib-api.vercel.app/api/proxy/anime?q=jujutsu&limit=10"
# –ü–æ–ª—É—á–∞–µ–º: id=16133, slug_url="16133--jujutsu-kaisen-anime"

# 2. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–∞–π—Ç–ª–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
curl "https://animelib-api.vercel.app/api/proxy/anime/16133--jujutsu-kaisen-anime"

# 3. –°–ø–∏—Å–æ–∫ —ç–ø–∏–∑–æ–¥–æ–≤
curl "https://animelib-api.vercel.app/api/proxy/episodes?anime_id=16133&limit=24"
# –ü–æ–ª—É—á–∞–µ–º: –ø–µ—Ä–≤—ã–π —ç–ø–∏–∑–æ–¥ episode_id=41924

# 4. –î–µ—Ç–∞–ª–∏ —ç–ø–∏–∑–æ–¥–∞ —Å –ø–ª–µ–µ—Ä–∞–º–∏
curl "https://animelib-api.vercel.app/api/proxy/episodes/41924"
# –ü–æ–ª—É—á–∞–µ–º: Kodik —Å—Å—ã–ª–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∑–≤—É—á–µ–∫

# 5. –ü–æ–ª—É—á–µ–Ω–∏–µ –ø—Ä—è–º—ã—Ö –≤–∏–¥–µ–æ-—Å—Å—ã–ª–æ–∫ (–ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è fix)
curl "https://animelib-api.vercel.app/api/kodik/episode?episode_id=41924"
# –í–µ—Ä–Ω–µ—Ç: –ø—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –≤–∏–¥–µ–æ –≤ —Ä–∞–∑–Ω—ã—Ö –∫–∞—á–µ—Å—Ç–≤–∞—Ö (480p, 720p, 1080p)
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

API –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–µ–Ω –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ Kodik –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –¥–µ–ø–ª–æ—é. –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ Vercel –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.
